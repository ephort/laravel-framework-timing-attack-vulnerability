<?php

namespace Illuminate\Support;

class Timebox
{
    /**
     * Is the timebox allowed to do an early return
     *
     * @var boolean
     */
    public bool $earlyReturn = false;

    public function make(callable $callback, int $microseconds): mixed
    {
        $start = microtime(true);

        $result = $callback($this);

        $remainder = $microseconds - ((microtime(true) - $start) * 1000000);

        if (! $this->earlyReturn && $remainder > 0) {
            usleep($remainder);
        }

        return $result;
    }

    public function returnEarly(): self
    {
        $this->earlyReturn = true;

        return $this;
    }

    public function dontReturnEarly(): self
    {
        $this->earlyReturn = false;

        return $this;
    }
}
