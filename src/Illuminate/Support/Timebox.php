<?php

namespace Illuminate\Support;

class Timebox
{
    /**
     * Are the timebox allowed to do early return
     *
     * @var boolean
     */
    public bool $earlyReturn = false;

    public function __invoke(callable $callback, int $microseconds)
    {
        $start = microtime(true);

        $result = $callback($this);

        while (! $this->earlyReturn && microtime(true) - $start < $microseconds / 1000000) {
            usleep(5);
        }

        return $result;
    }

    public function returnEarly(): self
    {
        $this->earlyReturn = true;

        return $this;
    }

    public function dontReturnEarly(): self
    {
        $this->earlyReturn = false;

        return $this;
    }
}
